<header>
  <%= link_to '<', root_path, class: 'back-button' %>
  <h1 class="paynow-header">Create Quick Shortcut</h1>
</header>

<!-- <div class="whitespace" style="background-color: #f1f2f4;"></div> -->

<div class="header-content">
  <div class="left-container">
    <div class="circle-container">
      <div class="circle-icon">
        <%= image_tag('dbslogoonly.png', alt: 'DBS Logo', class: 'DBSlogo', style: 'width: 22px; height: 20px;') %>
      </div>
    </div>
    <div class="arrow-gif-container">
      <%= image_tag('gif.gif', alt: 'Moving Arrow', class: 'arrow-gif', style: 'width: 50px; height: 30px;') %>
    </div>
    <div class="circle-container">
      <div class="circle-icon">
        <%= image_tag('dbslogoonly.png', alt: 'DBS Logo', class: 'DBSlogo', style: 'width: 22px; height: 20px;') %>
      </div>
    </div>
  </div>
  <div class="right-container">
    <div class="myaccounttext">
      <p style="font-weight: 530; color: #505050; margin-top: 10px; margin-bottom: 2px;">My Account</p>
      <div class="account-number">
        <p style="font-size: 15px; font-weight: bold; color: #a8abb0; display: inline-block;">271xxxxxxx0</p>
        <p class="text-right" style="margin-left: 100px;">SGD 29,891</p>
      </div>
    </div>
    <div class="horizontal-line"></div>
    <%= form_with(model: @shortcut, url: shortcuts_path, method: :post) do |form| %>
      <div class="recipienttext">
        <%= form.text_field :recipient_name, value: params.dig(:shortcut, :recipient_name), class: 'form-control grey-textbox' %>
      </div>
  </div>
</div>

<div class="whitespace1"></div>

<div class="moneybody">
  <div class='num-left'>
    <p class="amtin">Amount in</p>
    <p class="currency">SGD</p>
  </div>
  <div class='num-right'>
    <%= form.number_field :amount, value: params.dig(:shortcut, :amount), step: 0.01, class: 'amount-field', placeholder: '0.00' %>
  </div>
</div>

<div class="grey-box">
  <div class="field" style="margin-left: 20px; padding-top:10px;">
    <%# <div class="whitespace"></div> %>
    <%= form.label :nickname, "Shortcut Name" %>
    <%= form.text_field :nickname, 
                        # value: params.dig(:shortcut, :nickname), 
                        class: 'form-control white-textbox', 
                        maxlength: 10, 
                        style: 'width: 90%; border: 2px solid #ccc;',
                        oninput: "this.value = this.value.slice(0, 10); document.getElementById('char-count').textContent = this.value.length; updateWidgetIcons();" %>
    <span id="char-count" class="small-text" style="font-size: 12px;">0</span><span class="small-text" style="font-size: 12px;">/10 characters</span>
  </div>

  <div class="field" style="margin-left: 20px;">
    <%= form.label :widget_icon, "Widget Icon" %>
    <div>
      <label for="shortcut_button_widget_type_nickname">
        <canvas id="nickname-icon" width="100" height="100"></canvas>
      </label>
    </div>
  </div>
</div>


<!-- Other form fields... -->
<div class="next-button">
  <%= form.submit "Create Quick Shortcut", id: "next-button" %>
</div>
<% end %>
</div>

<style>
  .grey-textbox {
    background-color: #dfdfdf;
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
    width: 90%;
  }

  canvas {
    border: 2px solid #ccc;
    border-radius: 15px; /* Adjust the radius for rounded edges */
  }

  .small-text {
    font-size: 12px;
  }
</style>

<script>
document.addEventListener('turbo:load', function() {
  var nicknameField = document.querySelector('input[name="shortcut[nickname]"]');
  var charCount = document.getElementById('char-count');
  // charCount.textContent = nicknameField.value.length;
  updateWidgetIcons();
});

function updateWidgetIcons() {
  var nickname = document.querySelector('input[name="shortcut[nickname]"]').value;
  var initial = nickname.charAt(0).toUpperCase();
  
  drawIcon('nickname-icon', nickname || '$', '#066DAF');
}

function drawIcon(canvasId, text, color) {
  var canvas = document.getElementById(canvasId);
  var ctx = canvas.getContext('2d');
  var radius = 15; // Adjust the radius for rounded edges

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = color;
  roundRect(ctx, 0, 0, canvas.width, canvas.height, radius);
  ctx.fill();

  ctx.fillStyle = 'white';
  ctx.font = 'bold 24px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(text, canvas.width / 2, canvas.height / 2, canvas.width - 10);
}

function roundRect(ctx, x, y, width, height, radius) {
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + width - radius, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
  ctx.lineTo(x + width, y + height - radius);
  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
  ctx.lineTo(x + radius, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
  ctx.lineTo(x, y + radius);
  ctx.quadraticCurveTo(x, y, x + radius, y);
  ctx.closePath();
}

function drawFullIcon(canvasId, name, amount, color) {
  var canvas = document.getElementById(canvasId);
  var ctx = canvas.getContext('2d');
  var radius = 15; // Adjust the radius for rounded edges

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = color;
  roundRect(ctx, 0, 0, canvas.width, canvas.height, radius);
  ctx.fill();

  ctx.fillStyle = 'white';
  ctx.font = 'bold 14px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(name, canvas.width / 2, canvas.height / 3);
  ctx.fillText(amount, canvas.width / 2, canvas.height * 2 / 3);
}
</script>
