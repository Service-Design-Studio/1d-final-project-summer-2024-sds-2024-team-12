<div style="padding:10px">
  <h1>Create shortcut</h1>

  <%= form_with(model: @shortcut, url: shortcuts_path, method: :post) do |form| %>
    <div class="field">
      <%= form.label :recipient_name %>
      <%= form.text_field :recipient_name, value: params.dig(:shortcut, :recipient_name), class: 'form-control grey-textbox', readonly: true %>
    </div>
    <div class="field">
      <%= form.label :amount %>
      <%= form.number_field :amount, value: params.dig(:shortcut, :amount), step: 0.01, class: 'form-control grey-textbox', readonly: true %>
    </div>

    <div class="field">
      <%= form.label :nickname, "Shortcut Name" %>
      <%= form.text_field :nickname, 
                          value: params.dig(:shortcut, :nickname), 
                          class: 'form-control grey-textbox', 
                          maxlength: 10, 
                          oninput: "this.value = this.value.slice(0, 10); document.getElementById('char-count').textContent = this.value.length; updateWidgetIcons();" %>
      <span id="char-count" class="small-text" style="font-size: 12px;">0</span><span class="small-text" style="font-size: 12px;">/10 characters</span>
    </div>

    <div class="field">
      <%= form.label :widget_icon, "Widget Icon" %>
      <div>
        <label for="shortcut_button_widget_type_nickname">
          <canvas id="nickname-icon" width="100" height="100"></canvas>
        </label>
      </div>
    </div>

    <!-- Other form fields... -->
    <div class="actions" style="margin-top:10px">
      <%= form.submit 'Create Shortcut Button', class: 'btn btn-primary' %>
    </div>
  <% end %>
</div>

<style>
  .grey-textbox {
    background-color: #dfdfdf;
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 5px;
  }

  canvas {
    border: 2px solid #ccc;
    border-radius: 15px; /* Adjust the radius for rounded edges */
  }

  .small-text {
    font-size: 12px;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var nicknameField = document.querySelector('input[name="shortcut[nickname]"]');
  var charCount = document.getElementById('char-count');
  charCount.textContent = nicknameField.value.length;
  updateWidgetIcons();
});

function updateWidgetIcons() {
  var nickname = document.querySelector('input[name="shortcut[nickname]"]').value;
  var initial = nickname.charAt(0).toUpperCase();
  
  drawIcon('nickname-icon', initial || '$', '#066DAF');
}

function drawIcon(canvasId, text, color) {
  var canvas = document.getElementById(canvasId);
  var ctx = canvas.getContext('2d');
  var radius = 15; // Adjust the radius for rounded edges

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = color;
  roundRect(ctx, 0, 0, canvas.width, canvas.height, radius);
  ctx.fill();

  ctx.fillStyle = 'white';
  ctx.font = 'bold 24px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(text, canvas.width / 2, canvas.height / 2, canvas.width - 10);
}

function roundRect(ctx, x, y, width, height, radius) {
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + width - radius, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
  ctx.lineTo(x + width, y + height - radius);
  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
  ctx.lineTo(x + radius, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
  ctx.lineTo(x, y + radius);
  ctx.quadraticCurveTo(x, y, x + radius, y);
  ctx.closePath();
}

function drawFullIcon(canvasId, name, amount, color) {
  var canvas = document.getElementById(canvasId);
  var ctx = canvas.getContext('2d');
  var radius = 15; // Adjust the radius for rounded edges

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = color;
  roundRect(ctx, 0, 0, canvas.width, canvas.height, radius);
  ctx.fill();

  ctx.fillStyle = 'white';
  ctx.font = 'bold 14px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(name, canvas.width / 2, canvas.height / 3);
  ctx.fillText(amount, canvas.width / 2, canvas.height * 2 / 3);
}
</script>
