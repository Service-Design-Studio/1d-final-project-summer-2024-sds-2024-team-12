<div style="padding:10px">
  <h1>Create shortcut</h1>

  <%= form_with(model: @shortcut_button, url: shortcut_buttons_path, method: :post) do |form| %>
    <div class="field">
      <%= form.label :recipient_name %>
      <%= form.text_field :recipient_name, value: params.dig(:shortcut_button, :recipient_name), class: 'form-control', readonly: true %>
    </div>
    <div class="field">
      <%= form.label :amount %>
      <%= form.number_field :amount, value: params.dig(:shortcut_button, :amount), step: 0.01, class: 'form-control', readonly: true %>
    </div>

    <div class="field">
      <%= form.label :nickname, "Shortcut Name" %>
      <%= form.text_field :nickname, 
                          value: params.dig(:shortcut_button, :nickname), 
                          class: 'form-control', 
                          maxlength: 10, 
                          oninput: "this.value = this.value.slice(0, 10); document.getElementById('char-count').textContent = this.value.length; updateWidgetIcons();" %>
      <span id="char-count">0</span>/10 characters
    </div>

    <div>
      <p>Widget Icon</p>
        <label for="shortcut_button_widget_type_nickname">
          <canvas id="nickname-icon" width="100" height="100"></canvas>
        </label>
    </div>

    <!-- Other form fields... -->
    <div class="actions" style="margin-top:10px">
      <%= form.submit 'Create Shortcut Button', class: 'btn btn-primary' %>
    </div>
  <% end %>
</div>

<style>
  #nickname-icon canvas {
    border: 2px solid #ccc;
    border-radius: 15px; /* Adjust the radius for rounded edges */
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var nicknameField = document.querySelector('input[name="shortcut_button[nickname]"]');
  var charCount = document.getElementById('char-count');
  charCount.textContent = nicknameField.value.length;
  updateWidgetIcons();
});

function updateWidgetIcons() {
  var nickname = document.querySelector('input[name="shortcut_button[nickname]"]').value;

  drawIcon('nickname-icon', nickname || 'Nickname', '#066DAF');
}

function drawIcon(canvasId, text, color) {
  var canvas = document.getElementById(canvasId);
  var ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  ctx.fillStyle = color;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  ctx.fillStyle = 'white';
  ctx.font = 'bold 24px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(text, canvas.width / 2, canvas.height / 2, canvas.width - 10);
}

function drawFullIcon(canvasId, name, amount, color) {
  var canvas = document.getElementById(canvasId);
  var ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  ctx.fillStyle = color;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  ctx.fillStyle = 'white';
  ctx.font = 'bold 14px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(name, canvas.width / 2, canvas.height / 3);
  ctx.fillText(amount, canvas.width / 2, canvas.height * 2/3);
}

</script>